from .cart import Cart

def cart_total_amount(request):
    if request.user.is_authenticated:
        cart = Cart(request)
        total_bill = 0.0
        cart_items = request.session.get('cart', {})  # Safely get the cart dictionary

        for key, value in cart_items.items():
            try:
                price = float(value.get('price', 0))  # Default price to 0 if missing
                quantity = value.get('quantity', 1)  # Default quantity to 1 if missing
                total_bill += price * quantity
            except (TypeError, ValueError) as e:
                # Handle cases where price or quantity are not valid numbers
                print(f"Error processing cart item {key}: {e}")

        return {'cart_total_amount': total_bill}

    # If the user is not authenticated, return 0 as the total
    return {'cart_total_amount': 0}
